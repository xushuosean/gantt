!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).Gantt=e()}(this,(function(){"use strict";var t,e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},e(t,n)};function n(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function i(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(i.prototype=n.prototype,new i)}"function"==typeof SuppressedError&&SuppressedError,function(t){t.CLICK="click",t.MOUSEDOWN="mousedown",t.MOUSEMOVE="mousemove",t.MOUSEUP="mouseup",t.CHANGE="change"}(t||(t={}));var i=t,o=function(){function t(){this.eventListeners=[]}return t.prototype.addListener=function(t,e){null==this.eventListeners&&(this.eventListeners=[]),this.eventListeners.push(t),this.eventListeners.push(e)},t.prototype.removeListener=function(t){if(null!=this.eventListeners)for(var e=0;e<this.eventListeners.length;)this.eventListeners[e+1]==t?this.eventListeners.splice(e,2):e+=2},t.prototype.fireEvent=function(t){if(null!=this.eventListeners)for(var e=[t],n=0;n<this.eventListeners.length;n+=2){var i=this.eventListeners[n];null!==i&&i!==t.getName()||this.eventListeners[n+1].apply(this,e)}},t}(),r=function(t){function e(e){var n=t.call(this)||this;return n.handlers=new Map,n.gantt=e,n.gantt.addMouseListener(n),n.gantt.selectionModel.addListener(i.CHANGE,n.refresh.bind(n)),n}return n(e,t),e.prototype.mouseDown=function(t){this.handlers.forEach((function(e){e.mouseDown.apply(e,[t])}))},e.prototype.mouseMove=function(t){this.handlers.forEach((function(e){e.mouseMove.apply(e,[t])}))},e.prototype.mouseUp=function(t){this.handlers.forEach((function(e){e.mouseUp.apply(e,[t])}))},e.prototype.refresh=function(){var t=this.gantt.selectionModel.cells.slice(),e=this.handlers;this.handlers=new Map,e.forEach((function(t){t.destroy()}));for(var n=0;n<t.length;n++){var i=this.gantt.view.getState(t[n]);if(i){var o=this.handlers.get(t[n]);o?console.log("has handler exists"):(o=this.gantt.createBarHandler(i),this.handlers.set(t[n],o))}}},e}(o),s=function(){function t(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];this.name="",this.consumed=!1,this.name=t,this.properties=[];for(var i=0;i<e.length+1;i+=2)null!=e[i+1]&&(this.properties[e[i]]=e[i+1])}return t.prototype.getName=function(){return this.name},t.prototype.getProperties=function(){return this.properties},t.prototype.getProperty=function(t){return this.properties[t]},t.prototype.consume=function(){this.consumed=!0},t.prototype.isConsumed=function(){return this.consumed},t}(),a=function(){function t(t,e,n){this.selectionModel=t,this.added=e?e.slice():[],this.removed=n?n.slice():[]}return t.prototype.execute=function(){var t=this;this.removed&&this.removed.forEach((function(e){t.selectionModel.cellRemoved(e)})),this.added&&this.added.forEach((function(e){t.selectionModel.cellAdded(e)})),console.log("added",this.added,"removed",this.removed),this.selectionModel.fireEvent(new s(i.CHANGE,"added",this.added,"removed",this.removed))},t}(),h=function(t){function e(e){var n=t.call(this)||this;return n.cells=[],n.gantt=e,n}return n(e,t),e.prototype.setCell=function(t){t&&this.setCells([t])},e.prototype.setCells=function(t){this.changeSelection(t,this.cells)},e.prototype.changeSelection=function(t,e){new a(this,t,e).execute()},e.prototype.cellAdded=function(t){t&&this.cells.push(t)},e.prototype.clear=function(){this.changeSelection([],this.cells)},e.prototype.cellRemoved=function(t){if(t){var e=this.cells.indexOf(t);e>=0&&this.cells.splice(e,1)}},e}(o);"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function u(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var l={exports:{}};!function(t,e){t.exports=function(){var t=1e3,e=6e4,n=36e5,i="millisecond",o="second",r="minute",s="hour",a="day",h="week",u="month",l="quarter",c="year",d="date",p="Invalid Date",f=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,y=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,g={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(t){var e=["th","st","nd","rd"],n=t%100;return"["+t+(e[(n-20)%10]||e[n]||e[0])+"]"}},v=function(t,e,n){var i=String(t);return!i||i.length>=e?t:""+Array(e+1-i.length).join(n)+t},m={s:v,z:function(t){var e=-t.utcOffset(),n=Math.abs(e),i=Math.floor(n/60),o=n%60;return(e<=0?"+":"-")+v(i,2,"0")+":"+v(o,2,"0")},m:function t(e,n){if(e.date()<n.date())return-t(n,e);var i=12*(n.year()-e.year())+(n.month()-e.month()),o=e.clone().add(i,u),r=n-o<0,s=e.clone().add(i+(r?-1:1),u);return+(-(i+(n-o)/(r?o-s:s-o))||0)},a:function(t){return t<0?Math.ceil(t)||0:Math.floor(t)},p:function(t){return{M:u,y:c,w:h,d:a,D:d,h:s,m:r,s:o,ms:i,Q:l}[t]||String(t||"").toLowerCase().replace(/s$/,"")},u:function(t){return void 0===t}},w="en",b={};b[w]=g;var S=function(t){return t instanceof x},E=function t(e,n,i){var o;if(!e)return w;if("string"==typeof e){var r=e.toLowerCase();b[r]&&(o=r),n&&(b[r]=n,o=r);var s=e.split("-");if(!o&&s.length>1)return t(s[0])}else{var a=e.name;b[a]=e,o=a}return!i&&o&&(w=o),o||!i&&w},M=function(t,e){if(S(t))return t.clone();var n="object"==typeof e?e:{};return n.date=t,n.args=arguments,new x(n)},C=m;C.l=E,C.i=S,C.w=function(t,e){return M(t,{locale:e.$L,utc:e.$u,x:e.$x,$offset:e.$offset})};var x=function(){function g(t){this.$L=E(t.locale,null,!0),this.parse(t)}var v=g.prototype;return v.parse=function(t){this.$d=function(t){var e=t.date,n=t.utc;if(null===e)return new Date(NaN);if(C.u(e))return new Date;if(e instanceof Date)return new Date(e);if("string"==typeof e&&!/Z$/i.test(e)){var i=e.match(f);if(i){var o=i[2]-1||0,r=(i[7]||"0").substring(0,3);return n?new Date(Date.UTC(i[1],o,i[3]||1,i[4]||0,i[5]||0,i[6]||0,r)):new Date(i[1],o,i[3]||1,i[4]||0,i[5]||0,i[6]||0,r)}}return new Date(e)}(t),this.$x=t.x||{},this.init()},v.init=function(){var t=this.$d;this.$y=t.getFullYear(),this.$M=t.getMonth(),this.$D=t.getDate(),this.$W=t.getDay(),this.$H=t.getHours(),this.$m=t.getMinutes(),this.$s=t.getSeconds(),this.$ms=t.getMilliseconds()},v.$utils=function(){return C},v.isValid=function(){return!(this.$d.toString()===p)},v.isSame=function(t,e){var n=M(t);return this.startOf(e)<=n&&n<=this.endOf(e)},v.isAfter=function(t,e){return M(t)<this.startOf(e)},v.isBefore=function(t,e){return this.endOf(e)<M(t)},v.$g=function(t,e,n){return C.u(t)?this[e]:this.set(n,t)},v.unix=function(){return Math.floor(this.valueOf()/1e3)},v.valueOf=function(){return this.$d.getTime()},v.startOf=function(t,e){var n=this,i=!!C.u(e)||e,l=C.p(t),p=function(t,e){var o=C.w(n.$u?Date.UTC(n.$y,e,t):new Date(n.$y,e,t),n);return i?o:o.endOf(a)},f=function(t,e){return C.w(n.toDate()[t].apply(n.toDate("s"),(i?[0,0,0,0]:[23,59,59,999]).slice(e)),n)},y=this.$W,g=this.$M,v=this.$D,m="set"+(this.$u?"UTC":"");switch(l){case c:return i?p(1,0):p(31,11);case u:return i?p(1,g):p(0,g+1);case h:var w=this.$locale().weekStart||0,b=(y<w?y+7:y)-w;return p(i?v-b:v+(6-b),g);case a:case d:return f(m+"Hours",0);case s:return f(m+"Minutes",1);case r:return f(m+"Seconds",2);case o:return f(m+"Milliseconds",3);default:return this.clone()}},v.endOf=function(t){return this.startOf(t,!1)},v.$set=function(t,e){var n,h=C.p(t),l="set"+(this.$u?"UTC":""),p=(n={},n[a]=l+"Date",n[d]=l+"Date",n[u]=l+"Month",n[c]=l+"FullYear",n[s]=l+"Hours",n[r]=l+"Minutes",n[o]=l+"Seconds",n[i]=l+"Milliseconds",n)[h],f=h===a?this.$D+(e-this.$W):e;if(h===u||h===c){var y=this.clone().set(d,1);y.$d[p](f),y.init(),this.$d=y.set(d,Math.min(this.$D,y.daysInMonth())).$d}else p&&this.$d[p](f);return this.init(),this},v.set=function(t,e){return this.clone().$set(t,e)},v.get=function(t){return this[C.p(t)]()},v.add=function(i,l){var d,p=this;i=Number(i);var f=C.p(l),y=function(t){var e=M(p);return C.w(e.date(e.date()+Math.round(t*i)),p)};if(f===u)return this.set(u,this.$M+i);if(f===c)return this.set(c,this.$y+i);if(f===a)return y(1);if(f===h)return y(7);var g=(d={},d[r]=e,d[s]=n,d[o]=t,d)[f]||1,v=this.$d.getTime()+i*g;return C.w(v,this)},v.subtract=function(t,e){return this.add(-1*t,e)},v.format=function(t){var e=this,n=this.$locale();if(!this.isValid())return n.invalidDate||p;var i=t||"YYYY-MM-DDTHH:mm:ssZ",o=C.z(this),r=this.$H,s=this.$m,a=this.$M,h=n.weekdays,u=n.months,l=n.meridiem,c=function(t,n,o,r){return t&&(t[n]||t(e,i))||o[n].slice(0,r)},d=function(t){return C.s(r%12||12,t,"0")},f=l||function(t,e,n){var i=t<12?"AM":"PM";return n?i.toLowerCase():i};return i.replace(y,(function(t,i){return i||function(t){switch(t){case"YY":return String(e.$y).slice(-2);case"YYYY":return C.s(e.$y,4,"0");case"M":return a+1;case"MM":return C.s(a+1,2,"0");case"MMM":return c(n.monthsShort,a,u,3);case"MMMM":return c(u,a);case"D":return e.$D;case"DD":return C.s(e.$D,2,"0");case"d":return String(e.$W);case"dd":return c(n.weekdaysMin,e.$W,h,2);case"ddd":return c(n.weekdaysShort,e.$W,h,3);case"dddd":return h[e.$W];case"H":return String(r);case"HH":return C.s(r,2,"0");case"h":return d(1);case"hh":return d(2);case"a":return f(r,s,!0);case"A":return f(r,s,!1);case"m":return String(s);case"mm":return C.s(s,2,"0");case"s":return String(e.$s);case"ss":return C.s(e.$s,2,"0");case"SSS":return C.s(e.$ms,3,"0");case"Z":return o}return null}(t)||o.replace(":","")}))},v.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},v.diff=function(i,d,p){var f,y=this,g=C.p(d),v=M(i),m=(v.utcOffset()-this.utcOffset())*e,w=this-v,b=function(){return C.m(y,v)};switch(g){case c:f=b()/12;break;case u:f=b();break;case l:f=b()/3;break;case h:f=(w-m)/6048e5;break;case a:f=(w-m)/864e5;break;case s:f=w/n;break;case r:f=w/e;break;case o:f=w/t;break;default:f=w}return p?f:C.a(f)},v.daysInMonth=function(){return this.endOf(u).$D},v.$locale=function(){return b[this.$L]},v.locale=function(t,e){if(!t)return this.$L;var n=this.clone(),i=E(t,e,!0);return i&&(n.$L=i),n},v.clone=function(){return C.w(this.$d,this)},v.toDate=function(){return new Date(this.valueOf())},v.toJSON=function(){return this.isValid()?this.toISOString():null},v.toISOString=function(){return this.$d.toISOString()},v.toString=function(){return this.$d.toUTCString()},g}(),O=x.prototype;return M.prototype=O,[["$ms",i],["$s",o],["$m",r],["$H",s],["$W",a],["$M",u],["$y",c],["$D",d]].forEach((function(t){O[t[1]]=function(e){return this.$g(e,t[0],t[1])}})),M.extend=function(t,e){return t.$i||(t(e,x,M),t.$i=!0),M},M.locale=E,M.isDayjs=S,M.unix=function(t){return M(1e3*t)},M.en=b[w],M.Ls=b,M.p={},M}()}(l);var c=u(l.exports),d={exports:{}};!function(t,e){t.exports=function(t,e,n){var i=function(t,e){if(!e||!e.length||1===e.length&&!e[0]||1===e.length&&Array.isArray(e[0])&&!e[0].length)return null;var n;1===e.length&&e[0].length>0&&(e=e[0]),n=(e=e.filter((function(t){return t})))[0];for(var i=1;i<e.length;i+=1)e[i].isValid()&&!e[i][t](n)||(n=e[i]);return n};n.max=function(){var t=[].slice.call(arguments,0);return i("isAfter",t)},n.min=function(){var t=[].slice.call(arguments,0);return i("isBefore",t)}}}(d);var p=u(d.exports);c.extend(p);var f,y=function(){function t(t,e,n){this.datas=[],this.gantt=t,this.tasks=e,this.options=n,this.init()}return t.prototype.init=function(){this.setupDate(),this.convertToCell()},t.prototype.getMinMaxDate=function(){var t=c(this.tasks[0].start),e=c(this.tasks[0].end);return this.tasks.forEach((function(n){t=c.min(c(t),c(n.start)),e=c.max(c(e),c(n.end))})),[t,e]},t.prototype.setupDate=function(){var t;t=this.getMinMaxDate(),this.ganttStart=t[0],this.ganttEnd=t[1]},Object.defineProperty(t.prototype,"diffMonth",{get:function(){return this.ganttEnd.diff(this.ganttStart,"month")},enumerable:!1,configurable:!0}),t.prototype.convertToCell=function(){var t=this;this.datas=this.tasks.map((function(e,n){return t.doConvert(e,n)}))},t.prototype.doConvert=function(t,e){var n=(c(t.start).month()-this.ganttStart.month())*this.getRenderColumnWidth(),i=this.headerHeight+this.rowHeight*e+this.options.padding/2,o=this.getRenderColumnWidth()*this.getSplitNumber(t),r=this.options.barHeight;return{id:t.id,value:t.value,x:n,y:i,width:o,height:r}},t.prototype.getSplitNumber=function(t){return c(t.end).diff(c(t.start),"month")+1},t.prototype.getRenderColumnWidth=function(){return this.options.viewMode?4*this.options.columnWidth:this.options.columnWidth},Object.defineProperty(t.prototype,"headerHeight",{get:function(){return this.options.headerHeight},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"rowHeight",{get:function(){return this.options.barHeight+this.options.padding},enumerable:!1,configurable:!0}),t}(),g=function(){function t(t,e,n,i){this.x=t,this.y=e,this.width=n,this.height=i}return t.prototype.clone=function(){return new t(this.x,this.y,this.width,this.height)},t}(),v=function(){function t(t,e){this.state=null,this.consumed=!1,this.evt=t,e&&(this.state=e,this.sourcerState=e)}return t.prototype.getEvent=function(){return this.evt},t.prototype.getX=function(){return this.getEvent().clientX},t.prototype.getY=function(){return this.getEvent().clientY},t.prototype.isComsumed=function(){return this.consumed},t.prototype.consume=function(t){t&&this.evt.preventDefault&&this.evt.preventDefault(),this.consumed=!0},t}(),m=function(){function t(){}return t.redirectMouseEvents=function(e,n,o){t.addGestureListeners(e,(function(t){n.fireMouseEvent(i.MOUSEDOWN,new v(t,o))}),(function(t){n.fireMouseEvent(i.MOUSEMOVE,new v(t,o))}),(function(t){n.fireMouseEvent(i.MOUSEUP,new v(t,o))}))},t.addGestureListeners=function(t,e,n,i){null!=e&&t.addEventListener("mousedown",e),null!=n&&t.addEventListener("mousemove",n),null!=i&&t.addEventListener("mouseup",i)},t}(),w=function(){function t(t){this.minStrokeWidth=1,this.root=t,this.reset()}return t.prototype.rect=function(t,e,n,i,o,r,s){var a=this.createElement("rect");r&&(i-=r,e+=r/2),s&&(n-=s,t+=s/2),a.setAttribute("x","".concat(t)),a.setAttribute("y","".concat(e)),a.setAttribute("width","".concat(n)),a.setAttribute("height","".concat(i)),o&&a.setAttribute("rx","".concat(o)),this.node=a},t.prototype.ellipse=function(t,e,n,i){var o=this.createElement("ellipse");o.setAttribute("cx","".concat(t+n/2)),o.setAttribute("cy","".concat(e+i/2)),o.setAttribute("rx","".concat(n/2)),o.setAttribute("ry","".concat(i/2)),this.node=o},t.prototype.end=function(){this.addNode(!0,!0)},t.prototype.addNode=function(t,e){var n=this.node;n&&(t&&this.state.fillColor?this.updateFill():n.setAttribute("fill","none"),e&&this.state.strokeColor&&this.updateStroke()),this.root.appendChild(this.node)},t.prototype.updateFill=function(){this.node.setAttribute("fill",String(this.state.fillColor).toLowerCase()),this.node.setAttribute("fill-opacity",String(this.state.alpha).toLowerCase())},t.prototype.updateStroke=function(){var t=this.state;this.node.setAttribute("stroke",String(t.strokeColor).toLocaleLowerCase()),(t.alpha<1||t.strokeAlpha<1)&&this.node.setAttribute("stroke-opacity",(t.alpha*t.strokeAlpha).toString());var e=this.getCurrentStrokeWidth();1!==e&&this.node.setAttribute("stroke-width",e.toString()),t.dashed&&this.node.setAttribute("stroke-dasharray",this.createDashPattern((t.fixDash?1:t.strokeWidth)*t.scale))},t.prototype.format=function(t){return parseFloat(parseFloat(t).toFixed(2))},t.prototype.getCurrentStrokeWidth=function(){return Math.max(this.minStrokeWidth,Math.max(.01,this.format(this.state.strokeWidth*this.state.scale)))},t.prototype.createDashPattern=function(t){var e=[];if("string"==typeof this.state.dashPattern){var n=this.state.dashPattern.split(" ");if(n.length>0)for(var i=0;i<n.length;i++)e[i]=Number(n[i])*t}return e.join(" ")},t.prototype.createElement=function(t){return this.root.ownerDocument.createElement(t)},t.prototype.reset=function(){this.state=this.createState()},t.prototype.createState=function(){return{fillColor:null,alpha:1,strokeColor:null,dashed:!1,dashPattern:"3 3",fixDash:!1,strokeWidth:1,scale:1,strokeAlpha:1}},t.prototype.setFillColor=function(t){this.state.fillColor=t},t.prototype.setStrokeColor=function(t){this.state.strokeColor=t},t.prototype.setStrokeWidth=function(t){this.state.strokeWidth=t},t.prototype.setDashed=function(t,e){this.state.dashed=t,this.state.fixDash=e},t.prototype.setDashPattern=function(t){this.state.dashPattern=t},t.prototype.setAlpha=function(t){this.state.alpha=t},t}(),b=function(){function t(){this.initStyles()}return t.prototype.initStyles=function(){this.strokeWidth=1,this.opacity=100},t.prototype.init=function(t){this.node=this.create(t),t&&t.appendChild(this.node)},t.prototype.create=function(t){return this.createSvg()},t.prototype.createSvg=function(){return document.createElementNS("http://www.w3.org/2000/svg","g")},t.prototype.redraw=function(){this.clear();var t=this.createCanvas();this.doRedrawShape(t),this.node.insertAdjacentHTML("beforeend",t.root.outerHTML)},t.prototype.doRedrawShape=function(t){this.beforePaint(t),this.paint(t),this.afterPaint(t)},t.prototype.beforePaint=function(t){},t.prototype.paint=function(t){this.configureCanvas(t),this.paintShape(t,this.bounds.x,this.bounds.y,this.bounds.width,this.bounds.height)},t.prototype.afterPaint=function(t){},t.prototype.paintShape=function(t,e,n,i,o){this.paintBackground(t,e,n,i,o),this.paintForeground(t,e,n,i,o)},t.prototype.paintBackground=function(t,e,n,i,o){},t.prototype.paintForeground=function(t,e,n,i,o){},t.prototype.configureCanvas=function(t){t.setFillColor(this.fillColor),t.setAlpha(this.opacity/100),t.setDashed(!0,!0),t.setStrokeColor(this.stroke)},t.prototype.createCanvas=function(){return new w(this.node)},t.prototype.apply=function(t){this.state=t},t.prototype.destroy=function(){null!=this.node.parentNode&&this.node.parentNode.removeChild(this.node)},t.prototype.setCursor=function(t){void 0===t&&(t=""),this.cursor=t,null!=this.node&&(this.node.style.cursor=t)},t.prototype.clear=function(){if(null!=this.node.ownerSVGElement)for(;null!=this.node.lastChild;)this.node.removeChild(this.node.lastChild);else this.node.style.cssText="position:absolute;"+(null!=this.cursor?"cursor:"+this.cursor+";":""),this.node.innerHTML=""},t}(),S=function(t){function e(e,n,i,o){var r=t.call(this)||this;return r.bounds=e,r.fillColor=n,r.stroke=i,void 0!==o&&(r.strokeWidth=o),r}return n(e,t),e.prototype.paintBackground=function(t,e,n,i,o){t.rect(e,n,i,o,4,0),t.end()},e}(b),E=function(t,e){this.x=0,this.y=0,this.x=t,this.y=e},M=function(t,e){this.x=0,this.y=0,t&&(this.x=t),e&&(this.y=e)};function C(t,e,n){var i=function(t,e){e=null!=e&&e;var n=null!=t?t.ownerDocument:document,i=n.body,o=n.documentElement,r=new M;for(;null!=t&&t!=i&&t!=o;)isNaN(t.scrollLeft)||isNaN(t.scrollTop)||(r.x+=t.scrollLeft,r.y+=t.scrollTop),t=e?t.parentNode:null;return r}(t,!1),o=function(t){var e=0,n=0,i=!1,o=t,r=document.body,s=document.documentElement;for(;null!=o&&o!=r&&o!=s&&!i;)o=o.parentNode;var a=t.getBoundingClientRect();null!=a&&(e+=a.left,n+=a.top);return new M(e,n)}(t);return o.x-=i.x,o.y-=i.y,new M(e-o.x,n-o.y)}function x(t,e,n){return t.x<=e&&t.x+t.width>=e&&t.y<=n&&t.y+t.height>=n}!function(t){t[t.left=10]="left",t[t.right=11]="right"}(f||(f={}));var O=function(){function t(t){this.sizers=[],this.startX=0,this.startY=0,this.unscaledBounds=null,this.bounds=null,this.index=null,this.state=t,this.init()}return t.prototype.init=function(){this.gantt=this.state.view.gantt,this.selectionBounds=this.getSelectionBounds(this.state),this.bounds=new g(this.selectionBounds.x,this.selectionBounds.y,this.selectionBounds.width,this.selectionBounds.height),this.selectionBorder=this.createSelectionShape(this.selectionBounds),this.selectionBorder.init(this.gantt.view.getOverlayPane()),this.sizers=[];var t=0;this.sizers.push(this.createSizer("w-resize",t++)),this.sizers.push(this.createSizer("e-resize",t++)),this.redraw()},t.prototype.createSizer=function(t,e){var n=new g(0,0,6,6),i=this.createSizerShape(n,e);return i.init(this.gantt.view.getOverlayPane()),m.redirectMouseEvents(i.node,this.gantt,this.state),i.setCursor(t),i},t.prototype.createSizerShape=function(t,e){return new S(t,"#00FF00","black")},t.prototype.getSelectionBounds=function(t){return new g(t.x,t.y,t.width,t.height)},t.prototype.createSelectionShape=function(t){return new S(t,"","#00a8ff",1)},t.prototype.redraw=function(){console.log("redraw"),this.drawPreview(),this.redrawHandles()},t.prototype.drawPreview=function(){this.preview&&(this.preview.bounds=this.bounds,console.log(this.preview.bounds),this.preview.redraw()),this.selectionBorder.bounds=this.bounds,this.selectionBorder.redraw()},t.prototype.redrawHandles=function(){var t=this.selectionBounds,e=t.x+t.width,n=t.y+t.height/2;this.moveSizerTo(this.sizers[0],t.x,n),this.moveSizerTo(this.sizers[1],e,n)},t.prototype.moveSizerTo=function(t,e,n){null!=t&&(t.bounds.x=Math.floor(e-t.bounds.width/2),t.bounds.y=Math.floor(n-t.bounds.height/2),null!=t.node&&"none"!=t.node.style.display&&t.redraw())},t.prototype.start=function(t,e,n){this.startX=t,this.startY=e,this.index=n,this.selectionBorder.node.style.display="none",this.preview=this.createSelectionShape(this.selectionBounds),this.preview.init(this.gantt.view.getOverlayPane())},t.prototype.resizeVertex=function(t){var e=new E(t.graphX,t.graphY).x-this.startX,n=this.gantt.getCellGeometry(this.state.cell);this.unscaledBounds=new g(null==n?void 0:n.x,null==n?void 0:n.y,(null==n?void 0:n.width)+e,(null==n?void 0:n.height)+0),this.bounds=new g(this.unscaledBounds.x,this.unscaledBounds.y,this.unscaledBounds.width,this.unscaledBounds.height),this.preview&&this.drawPreview()},t.prototype.getHandleForEvent=function(t){var e=null;return this.sizers.forEach((function(n,i){(function(t,e){var n=t.graphX,i=t.graphY;return x(e.bounds,n,i)})(t,n)&&(e=i)})),e},t.prototype.mouseDown=function(t){t.isComsumed()||this.getHandleForEvent(t)&&(this.start(t.graphX,t.graphY,f.left),t.consume())},t.prototype.mouseMove=function(t){t.isComsumed()||null==this.index||this.resizeVertex(t)},t.prototype.mouseUp=function(t){if(console.log(this.index),null!==this.index&&null!==this.state&&!t.isComsumed()){this.index,this.index=null;var e=new E(t.graphX,t.graphY);this.gantt.model.beginUpdate();try{e.x,this.startX,e.y,this.startY;this.resizeCell(this.state.cell)}finally{this.gantt.model.endUpdate()}t.consume(),this.reset(),this.redrawHandles()}},t.prototype.resizeCell=function(t){this.unscaledBounds&&this.gantt.resizeCell(t,this.unscaledBounds)},t.prototype.reset=function(){this.index=null,this.preview&&this.preview.destroy(),this.selectionBorder&&(this.selectionBorder.node.style.display="inline",this.selectionBounds=this.getSelectionBounds(this.state),this.bounds=new g(this.selectionBounds.x,this.selectionBounds.y,this.selectionBounds.width,this.selectionBounds.height),console.log("reset"),this.drawPreview()),this.unscaledBounds=null},t.prototype.destroy=function(){if(this.selectionBorder&&this.selectionBorder.destroy(),this.preview&&this.preview.destroy(),this.sizers)for(var t=0;t<this.sizers.length;t++)this.sizers[t].destroy()},t}(),D=function(t){function e(e){var n=t.call(this)||this;return n.gantt=e,n}return n(e,t),e}(o),H=function(t){function e(e,n){var i=t.call(this)||this;return i.bounds=e,i.fillColor=n,i}return n(e,t),e.prototype.paintBackground=function(t,e,n,i,o){t.rect(e,n,i,o,4),t.end()},e}(b),$=function(){function t(){this.defaultShapes=new Map,this.defaultShape=H}return t.prototype.redraw=function(t){this.redrawShape(t)},t.prototype.redrawShape=function(t){t.shape&&(t.shape.destroy(),t.shape=null),null===t.shape&&(t.shape=this.createShape(t),this.initializeShape(t),this.installListeners(t),t.shape.apply(t),t.shape.bounds=new g(t.x,t.y,t.width,t.height),this.doRedrawShape(t))},t.prototype.initializeShape=function(t){var e;null===(e=t.shape)||void 0===e||e.init(t.view.getDrawPane())},t.prototype.installListeners=function(t){var e,n,o,r=t.view.gantt;null===(e=t.shape)||void 0===e||e.node.addEventListener(i.MOUSEDOWN,(function(e){r.fireMouseEvent(i.MOUSEDOWN,new v(e,t))})),null===(n=t.shape)||void 0===n||n.node.addEventListener(i.MOUSEMOVE,(function(e){r.fireMouseEvent(i.MOUSEMOVE,new v(e,t))})),null===(o=t.shape)||void 0===o||o.node.addEventListener(i.MOUSEUP,(function(e){r.fireMouseEvent(i.MOUSEUP,new v(e,t))}))},t.prototype.doRedrawShape=function(t){var e;null===(e=t.shape)||void 0===e||e.redraw()},t.prototype.createShape=function(t){return new(this.getShapeConstructor(t))(t.cell.geometry,"#ccc")},t.prototype.registerShape=function(t,e){this.defaultShapes.set(t,e)},t.prototype.getShapeConstructor=function(t){var e=this.getShape("");return e||this.defaultShape},t.prototype.getShape=function(t){return t?this.defaultShapes.get(t):null},t}(),P=function(){function t(t){this.selectEnabled=!0,this.moveEnabled=!0,this.cellWasClicked=!1,this.gantt=t,this.gantt.addMouseListener(this)}return t.prototype.isSelectEnabled=function(){return this.selectEnabled},t.prototype.setSelectEnabled=function(t){this.selectEnabled=t},t.prototype.isMoveEnabled=function(){return this.moveEnabled},t.prototype.setMoveEnabled=function(t){this.moveEnabled=t},t.prototype.mouseDown=function(t){if(!t.isComsumed()&&t.state){var e=t.state.cell;console.log(e),this.isSelectEnabled()&&this.gantt.setSelectionCell(e),this.isMoveEnabled()&&(this.start(e,t.getX(),t.getY()),this.cellWasClicked=!0,t.consume())}},t.prototype.start=function(t,e,n){},t.prototype.mouseMove=function(){},t.prototype.mouseUp=function(t){this.cellWasClicked&&(console.log("cell was click",t.getEvent()),t.consume()),this.reset()},t.prototype.reset=function(){this.cellWasClicked=!1},t}();!function(t,e){void 0===e&&(e={});var n=e.insertAt;if(t&&"undefined"!=typeof document){var i=document.head||document.getElementsByTagName("head")[0],o=document.createElement("style");o.type="text/css","top"===n&&i.firstChild?i.insertBefore(o,i.firstChild):i.appendChild(o),o.styleSheet?o.styleSheet.cssText=t:o.appendChild(document.createTextNode(t))}}(".gantt .headerBackground {\n  fill: #ffffff;\n}\n\n.gantt .bodyRow {\n  fill: #f5f5f5\n}\n\n.gantt .bodyRow:nth-child(even) {\n  fill: #ffffff;\n}\n\n.gantt .row-line {\n  stroke: #ebeff2;\n}\n\n.gantt .bar {\n  fill: #1677ff;\n}\n\n.gantt .barText {\n  dominant-baseline: central;\n  fill: #555;\n}\n\n.ddd {\n  background-color: red;\n}");var B=function(t,e){this.shape=null,this.invalid=!1,this.view=t,this.cell=e};function L(t,e){var n=document.createElementNS("http://www.w3.org/2000/svg",t);for(var i in e){if("append_to"===i)e.append_to.appendChild(n);else"innerHTML"===i?n.innerHTML=e.innerHTML:n.setAttribute(i,e[i])}return n}var k,U,W=function(t){function e(e,n,i,o,r){var s=t.call(this)||this;return s.gantt=e,s.mode=n,s.columnNum=i,s.columnWidth=o,s.headerHeight=r,s}return n(e,t),e.prototype.init=function(t){this.container=t,this.createSvg(),this.renderTable()},e.prototype.createSvg=function(){var t=this.createGElement();this.tableHeaderPanel=this.createGElement(),this.tableHeaderPanel.classList.add("tableHeaderPanel"),t.appendChild(this.tableHeaderPanel),this.tableBodyPanel=this.createGElement(),this.tableBodyPanel.classList.add("tableBodyPanel"),t.appendChild(this.tableBodyPanel),this.tableBorderPanel=this.createGElement(),this.tableBorderPanel.classList.add("tableBorderPanel"),t.appendChild(this.tableBorderPanel),this.container.appendChild(t)},e.prototype.renderTable=function(){this.redrawTableHeader(),this.redrawTableBody(),this.redrawTableBorder(),this.updateGanttBounds()},e.prototype.updateGanttBounds=function(){this.gantt.view.ganttBounds=new g(0,0,this.getTableWidth(),this.getTableHeight())},e.prototype.redrawTableHeader=function(){L("rect",{x:0,y:0,width:this.getTableWidth(),height:this.headerHeight,class:"headerBackground",append_to:this.tableHeaderPanel});for(var t=0;t<=this.columnNum;t++){var e=this.gantt.ganttStart.add(t,"month"),n=e.year(),i=e.month()+1;6===i&&L("text",{x:t*this.getRenderColumnWidth()+this.getRenderColumnWidth()/2,y:30,innerHTML:n,append_to:this.tableHeaderPanel}),L("text",{x:t*this.getRenderColumnWidth(),y:50,innerHTML:i,append_to:this.tableHeaderPanel})}},Object.defineProperty(e.prototype,"rowHeight",{get:function(){return this.gantt.options.barHeight+this.gantt.options.padding},enumerable:!1,configurable:!0}),e.prototype.redrawTableBody=function(){var t=this;this.gantt.tasks.forEach((function(e,n){L("rect",{x:0,y:n*t.rowHeight+t.headerHeight,width:t.getTableWidth(),height:t.rowHeight,class:"bodyRow",append_to:t.tableBodyPanel}),t.rowHeight}))},e.prototype.redrawTableBorder=function(){for(var t=0;t<=this.columnNum;t++)L("line",{x1:this.getRenderColumnWidth()*t,y1:this.headerHeight,x2:this.getRenderColumnWidth()*t,y2:this.headerHeight+this.rowHeight*this.gantt.tasks.length,class:"row-line",append_to:this.tableBorderPanel})},e.prototype.createGElement=function(){return document.createElementNS("http://www.w3.org/2000/svg","g")},e.prototype.getTableWidth=function(){return this.columnNum*this.getRenderColumnWidth()},e.prototype.getTableHeight=function(){return this.headerHeight+this.rowHeight*this.gantt.tasks.length},e.prototype.getRenderColumnWidth=function(){return this.mode?4*this.columnWidth:this.columnWidth},e}(o),T=function(t){function e(e){var n=t.call(this)||this;return n.gantt=e,n.states=new Map,n}return n(e,t),e.prototype.init=function(){this.installListener(),this.createSvg()},e.prototype.isContainerEvent=function(t){var e=t.srcElement?t.srcElement:t.target,n=[this.gantt.container],i=e.parentNode;return n.some((function(t){return t===e}))||[this.tableView.tableBodyPanel].some((function(t){return t===i}))},e.prototype.installListener=function(){var t=this,e=this.gantt.container,n=this.gantt;e.addEventListener(i.MOUSEDOWN,(function(e){t.isContainerEvent(e)&&n.fireMouseEvent(i.MOUSEDOWN,new v(e))})),e.addEventListener(i.MOUSEMOVE,(function(e){t.isContainerEvent(e)&&n.fireMouseEvent(i.MOUSEMOVE,new v(e))})),e.addEventListener(i.MOUSEUP,(function(e){t.isContainerEvent(e)&&n.fireMouseEvent(i.MOUSEUP,new v(e))}))},e.prototype.createGElement=function(){return document.createElementNS("http://www.w3.org/2000/svg","g")},e.prototype.createSvg=function(){var t=this.gantt.container,e=this.canvas=document.createElementNS("http://www.w3.org/2000/svg","g");e.classList.add("canvas"),this.tableView=new W(this.gantt,this.gantt.options.viewMode,this.gantt.diffMonth+1,this.gantt.options.columnWidth,this.gantt.options.headerHeight),this.tableView.init(e),this.drawPane=this.createGElement(),this.drawPane.classList.add("drawPane"),e.appendChild(this.drawPane),this.overlayPane=this.createGElement(),this.overlayPane.classList.add("overlayPane"),e.appendChild(this.overlayPane);var n=document.createElementNS("http://www.w3.org/2000/svg","svg");n.style.left="0px",n.style.top="0px",n.style.width="100%",n.style.height="100%",n.style.display="block",n.classList.add("gantt"),n.appendChild(this.canvas),null!=t&&t.appendChild(n)},e.prototype.getState=function(t){var e=null;return t&&((e=this.states.get(t))||(e=this.createState(t),this.states.set(t,e))),e},e.prototype.createState=function(t){return new B(this,t)},e.prototype.invalidate=function(t){var e=this.getState(t);e&&(e.invalid=!0)},e.prototype.validate=function(){var t=this;this.gantt.model.cells.forEach((function(e){var n=t.getState(e);(null==n?void 0:n.invalid)&&(n.invalid=!1,t.updateCellState(n),t.gantt.barRenderer.redraw(n))}))},e.prototype.updateCellState=function(t){var e=this.gantt.getCellGeometry(t.cell);null!==e&&(t.x=e.x,t.y=e.y,t.width=e.width,t.height=e.height)},e.prototype.getDrawPane=function(){return this.drawPane},e.prototype.getOverlayPane=function(){return this.overlayPane},e}(o),N=function(){function t(t){this.source=t,this.changes=[]}return t.prototype.add=function(t){this.changes.push(t)},t.prototype.notify=function(){},t.prototype.isEmpty=function(){return 0===this.changes.length},t}(),A=function(){function t(t,e){this.model=t,this.cell=e}return t.prototype.execute=function(){},t}(),G=function(){function t(t,e,n){this.model=t,this.cell=e,this.geometry=n,this.previous=n}return t.prototype.execute=function(){null!=this.cell&&(this.geometry=this.previous,this.previous=this.model.geometryForCellChanged(this.cell,this.previous))},t}(),z=function(t){function e(){var e=t.call(this)||this;return e.updateLevel=0,e.endingUpdate=!1,e.cells=[],e.currentEdit=e.createUndoableEdit(),e}return n(e,t),e.prototype.add=function(t){this.cells.push(t),this.execute(new A(this,t))},e.prototype.execute=function(t){t.execute(),this.beginUpdate(),this.currentEdit.add(t),this.endUpdate()},e.prototype.createUndoableEdit=function(){var t=new N(this);return t.notify=function(){var e=new s(i.CHANGE,"edit",t,"chagnes",t.changes);t.source.fireEvent(e)},t},e.prototype.beginUpdate=function(){this.updateLevel++},e.prototype.endUpdate=function(){if(this.updateLevel--,!this.endingUpdate){this.endingUpdate=0===this.updateLevel;try{if(this.endingUpdate&&!this.currentEdit.isEmpty()){var t=this.currentEdit;this.currentEdit=this.createUndoableEdit(),t.notify()}}finally{this.endingUpdate=!1}}},e.prototype.getGeometry=function(t){return t?t.getGeometry():null},e.prototype.setGeometry=function(t,e){return this.execute(new G(this,t,e)),e},e.prototype.geometryForCellChanged=function(t,e){var n=this.getGeometry(t);return t.setGeometry(e),n},e}(o),_=function(){function t(t,e,n){this.value=t,this.geometry=e,this.style=n}return t.prototype.getGeometry=function(){return this.geometry},t.prototype.setGeometry=function(t){this.geometry=t},t}();!function(t){t.DAY="Day",t.WEEK="Week",t.MONTH="Month",t.YEAR="Year"}(U||(U={}));var R=((k={})[U.DAY]="day",k[U.WEEK]="week",k[U.MONTH]="month",k[U.YEAR]="year",k),Y=function(t){function e(e,n,o){var r=t.call(this)||this;return r.mouseListeners=[],r.isMouseDown=!1,r.tasks=n,r.options=o,r.container=e,r.setupOptions(),r.barRenderer=r.createBarRenderer(),r.model=new z,r.selectionModel=new h(r),r.view=r.createGanttView(),r.model.addListener(i.CHANGE,(function(t){t.getProperty("edit").changes.forEach(r.processChange.bind(r)),r.view.validate()})),r.codeToGantt=new y(r,r.tasks,r.options),r.createHandlers(),e&&r.init(e),r.sizeDidChange(),r.autoCreateCell(),r}return n(e,t),e.prototype.setSelectionCell=function(t){this.selectionModel.setCell(t)},e.prototype.setSelectionCells=function(t){this.selectionModel.setCells(t)},e.prototype.sizeDidChange=function(){var t=this.view.ganttBounds,e=this.view.getDrawPane().ownerSVGElement;e&&(e.style.minWidth="".concat(t.width,"px"),e.style.minHeight="".concat(t.height,"px"))},e.prototype.insertBar=function(t,e,n,i,o,r){var s=new _(e,new g(n,i,o,r),{});s.id=t,this.addCell(s)},e.prototype.autoCreateCell=function(){var t=this;this.codeToGantt.datas.forEach((function(e){t.insertBar(e.id,e.value,e.x,e.y,e.width,e.height)}))},e.prototype.processChange=function(t){(t instanceof A||t instanceof G)&&this.view.invalidate(t.cell)},e.prototype.createGanttView=function(){return new T(this)},e.prototype.init=function(t){this.view.init()},e.prototype.addCell=function(t){this.addCells([t])},e.prototype.addCells=function(t){var e=this;t.forEach((function(t){e.model.add(t)}))},e.prototype.addMouseListener=function(t){this.mouseListeners.push(t)},e.prototype.intersects=function(t,e,n){return x(t.cell.geometry,e,n)},e.prototype.getCellAt=function(t,e){for(var n=this.model.cells,i=0;i<n.length;i++){var o=n[i],r=this.view.getState(o);if(r&&this.intersects(r,t,e))return o}},e.prototype.updateMouseDown=function(t,e){e===i.MOUSEUP&&this.isMouseDown?this.isMouseDown=!1:e!==i.MOUSEDOWN||this.isMouseDown||(this.isMouseDown=!0)},e.prototype.fireMouseEvent=function(t,e){var n=C(this.container,e.getX(),e.getY());if(e.graphX=n.x,e.graphY=n.y,this.isMouseDown&&t===i.MOUSEMOVE){var o=this.getCellAt(e.graphX,e.graphY);o&&(e.state=this.view.getState(o))}this.updateMouseDown(e,t);for(var r=0;r<this.mouseListeners.length;r++){var s=this.mouseListeners[r];t===i.MOUSEDOWN?s.mouseDown.apply(s,[e]):t===i.MOUSEMOVE?s.mouseMove.apply(s,[e]):t===i.MOUSEUP&&(console.log(s,"mouseup"),s.mouseUp.apply(s,[e]))}t===i.MOUSEUP&&this.click(e)},e.prototype.click=function(t){var e;t.getEvent();var n=null===(e=t.state)||void 0===e?void 0:e.cell;console.log(t.isComsumed()),t.isComsumed()||(n?this.setSelectionCell(n):this.clearSelection())},e.prototype.clearSelection=function(){this.selectionModel.clear()},e.prototype.getCellGeometry=function(t){return this.model.getGeometry(t)},e.prototype.addBar=function(){},e.prototype.createBarRenderer=function(){return new $},e.prototype.createHandlers=function(){this.selectionBarHandler=this.createSelectionBarHandler(),this.ganttHandler=this.createGanttHandler(),this.createPopupHandler()},e.prototype.createGanttHandler=function(){return new P(this)},e.prototype.createBarHandler=function(t){return new O(t)},e.prototype.createSelectionBarHandler=function(){return new r(this)},e.prototype.createPopupHandler=function(){return new D(this)},e.prototype.resizeCell=function(t,e){this.resizeCells([t],[e])},e.prototype.resizeCells=function(t,e){this.model.beginUpdate();try{this.cellsResized(t,e)}finally{this.model.endUpdate()}},e.prototype.cellsResized=function(t,e){var n=this;this.model.beginUpdate();try{t.forEach((function(t,i){n.cellResized(t,e[i])}))}finally{this.model.endUpdate()}},e.prototype.cellResized=function(t,e){var n=this.getCellGeometry(t),i=null==n?void 0:n.clone();i.x=e.x,i.y=e.y,i.width=e.width,i.height=e.height,this.model.beginUpdate();try{this.model.setGeometry(t,i)}finally{this.model.endUpdate()}},e.prototype.getSplitNumber=function(t){return dayjs(t.end).diff(dayjs(t.start),R[this.options.viewMode])+1},e.prototype.createGElement=function(){return document.createElementNS("http://www.w3.org/2000/svg","g")},e.prototype.setupOptions=function(){var t={headerHeight:80,columnWidth:30,step:24,viewMode:U.DAY,barHeight:30,padding:18};this.options=Object.assign({},t,this.options)},e.prototype.getRenderColumnWidth=function(){return this.options.viewMode?4*this.options.columnWidth:this.options.columnWidth},e.prototype.getTableWidth=function(){return this.diffMonth*this.getRenderColumnWidth()},Object.defineProperty(e.prototype,"ganttStart",{get:function(){return this.codeToGantt.ganttStart},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ganttEnd",{get:function(){return this.codeToGantt.ganttEnd},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"diffMonth",{get:function(){return this.codeToGantt.diffMonth},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rowHeight",{get:function(){return this.options.barHeight+this.options.padding},enumerable:!1,configurable:!0}),e.prototype.dispose=function(){},e}(o);return Y}));
